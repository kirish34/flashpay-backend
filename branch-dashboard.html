<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flash Pay Branch Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      padding: 30px;
      background: #f9fafb;
    }
    .dashboard-card {
      margin-bottom: 20px;
      padding: 20px;
      border-radius: 10px;
      background: white;
      box-shadow: 0px 0px 8px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>

<h2>üè¨ Flash Pay - Branch Dashboard</h2>
<p id="branchNameDisplay"></p>
<hr>

<div class="dashboard-card">
  <h4>üìã Live Transactions</h4>
  <button class="btn btn-primary" onclick="fetchBranchTX()">Refresh</button>
  <br><br>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>TX Code</th>
        <th>Amount (KES)</th>
        <th>Status</th>
        <th>Created</th>
      </tr>
    </thead>
    <tbody id="branchTxTable"></tbody>
  </table>
</div>

<script>
// üî• Change branch name manually here for now (later can add dynamic login)
const branchName = "Naivas OTC"; 

document.getElementById('branchNameDisplay').innerText = "Branch: " + branchName;

// Fetch branch-specific TXs
function fetchBranchTX() {
  fetch('/txcodes')
    .then(res => res.json())
    .then(data => {
      const table = document.getElementById('branchTxTable');
      table.innerHTML = '';
      data.forEach(tx => {
        // Simulate that this branch only views their own transactions
        if (tx.till === "123456") { // Replace with dynamic branch till later
          table.innerHTML += `
            <tr>
              <td>${tx.code}</td>
              <td>${tx.amount}</td>
              <td>${tx.status}</td>
              <td>${new Date(tx.createdAt).toLocaleString()}</td>
            </tr>
          `;
        }
      });
    })
    .catch(err => {
      alert('‚ùå Failed to fetch branch transactions');
      console.error(err);
    });
}

// Auto refresh every 10 seconds
setInterval(fetchBranchTX, 10000);

// Initial load
fetchBranchTX();
</script>

</body>
</html>
