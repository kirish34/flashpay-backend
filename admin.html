<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flash Pay Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      padding: 30px;
      background: #f4f6f8;
    }
    .dashboard-card {
      margin-bottom: 20px;
      padding: 20px;
      border-radius: 10px;
      background: white;
      box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <h2>🛡️ Flash Pay Admin Dashboard</h2>
  <hr>

  <div class="dashboard-card">
    <h4>🔎 View Transactions</h4>
    <button class="btn btn-primary" onclick="fetchTX()">Refresh TX Codes</button>
    <br><br>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>TX Code</th>
          <th>Amount</th>
          <th>Till</th>
          <th>Status</th>
          <th>Created At</th>
        </tr>
      </thead>
      <tbody id="txTable">
      </tbody>
    </table>
  </div>

  <div class="dashboard-card">
    <h4>🏢 Register New Branch</h4>
    <input type="text" id="branchName" class="form-control" placeholder="Branch Name">
    <br>
    <button class="btn btn-success" onclick="registerBranch()">Register Branch</button>
  </div>

  <div class="dashboard-card">
    <h4>👨‍💼 Register New Cashier</h4>
    <input type="text" id="cashierBranch" class="form-control" placeholder="Branch Name">
    <input type="text" id="cashierId" class="form-control" placeholder="Cashier ID (e.g 01)">
    <input type="text" id="cashierUSSD" class="form-control" placeholder="USSD Code (e.g *123*0101#)">
    <input type="text" id="cashierTill" class="form-control" placeholder="Till Number">
    <br>
    <button class="btn btn-info" onclick="registerCashier()">Register Cashier</button>
  </div>

<script>
function fetchTX() {
  fetch('/txcodes')
    .then(res => res.json())
    .then(data => {
      const table = document.getElementById('txTable');
      table.innerHTML = '';
      data.forEach(tx => {
        table.innerHTML += `
          <tr>
            <td>${tx.code}</td>
            <td>${tx.amount}</td>
            <td>${tx.till}</td>
            <td>${tx.status}</td>
            <td>${new Date(tx.createdAt).toLocaleString()}</td>
          </tr>
        `;
      });
    })
    .catch(err => {
      alert('Failed to fetch TX codes.');
      console.error(err);
    });
}

function registerBranch() {
  const branch = document.getElementById('branchName').value;
  if (!branch) return alert('Branch name required');
  alert('✅ Branch "' + branch + '" registered successfully (simulation)');
}

function registerCashier() {
  const branch = document.getElementById('cashierBranch').value;
  const cashierId = document.getElementById('cashierId').value;
  const ussdCode = document.getElementById('cashierUSSD').value;
  const till = document.getElementById('cashierTill').value;

  if (!branch || !cashierId || !ussdCode || !till) {
    return alert('All fields are required to register cashier');
  }

  fetch('/register-cashier', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ branch, cashierId, ussdCode, till })
  })
  .then(res => res.json())
  .then(data => {
    alert('✅ Cashier Registered Successfully!');
    console.log(data);
  })
  .catch(err => {
    alert('❌ Failed to register cashier');
    console.error(err);
  });
}
</script>

</body>
</html>
